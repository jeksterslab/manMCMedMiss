<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="manMCMedMiss">
<title>Monte Carlo Confidence Intervals from Multiple Imputation Estimates â€¢ manMCMedMiss</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.6/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.6/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.6/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Monte Carlo Confidence Intervals from Multiple Imputation Estimates">
<meta property="og:description" content="manMCMedMiss">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">manMCMedMiss</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/manMCMedMiss.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="https://github.com/jeksterslab/manMCMedMiss/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Monte Carlo Confidence Intervals from Multiple Imputation Estimates</h1>
                        <h4 data-toc-skip class="author">Ivan Jacob
Agaloos Pesigan</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jeksterslab/manMCMedMiss/blob/HEAD/vignettes/mc-mi.Rmd"><code>vignettes/mc-mi.Rmd</code></a></small>
      <div class="d-none name"><code>mc-mi.Rmd</code></div>
    </div>

    
    
<p>In this example, we use data from a study by Elliot and others (2007)
on the effects of an intervention on healthy dietary behavior mediated
by knowledge of healthy dietary behavior. This data was used as an
empirical example in Yuan and MacKinnon (2009) and Wu and Jia
(2013).</p>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jeksterslab/manMCMedMiss">manMCMedMiss</a></span><span class="op">)</span></span></code></pre></div>
<p>The data frame <code><a href="../reference/elliot2007.html">elliot2007()</a></code>, which is included in the
<code>manMCMedMiss</code> package, has 354 cases and 3 variables:</p>
<ul>
<li>
<code>x</code> - Intervention group membership.</li>
<li>
<code>m</code> - Knowledge of healthy dietary behavior (knowledge
post-intervention minus knowledge pre-intervention).</li>
<li>
<code>y</code> - Healthy dietary behavior (behavior
post-intervention minus behavior pre-intervention).</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">elliot2007</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">x</th>
<th align="right">m</th>
<th align="right">y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">1.0</td>
<td align="right">1.666666</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">4.000000</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">-0.5</td>
<td align="right">-0.666667</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0.5</td>
<td align="right">1.333333</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1.0</td>
<td align="right">2.333334</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="amputation">Amputation<a class="anchor" aria-label="anchor" href="#amputation"></a>
</h2>
<p>Generate sample data with missing values. The missing data mechanism
is missing at random (MAR). The proportion of missing cases is 0.30.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">data_missing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AmputeData.html">AmputeData</a></span><span class="op">(</span></span>
<span>  <span class="va">elliot2007</span>,</span>
<span>  mech <span class="op">=</span> <span class="st">"MAR"</span>,</span>
<span>  prop <span class="op">=</span> <span class="fl">0.10</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_missing</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">x</th>
<th align="right">m</th>
<th align="right">y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">1.000000</td>
<td align="right">1.666666</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">0.000000</td>
<td align="right">4.000000</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0.000000</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">-0.500000</td>
<td align="right">-0.666667</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0.500000</td>
<td align="right">1.333333</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1.000000</td>
<td align="right">2.333334</td>
</tr>
<tr class="odd">
<td align="right">NA</td>
<td align="right">1.166667</td>
<td align="right">3.333333</td>
</tr>
<tr class="even">
<td align="right">NA</td>
<td align="right">0.833333</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1.666667</td>
<td align="right">1.666667</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">-0.333333</td>
<td align="right">1.666666</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="multiple-imputation">Multiple Imputation<a class="anchor" aria-label="anchor" href="#multiple-imputation"></a>
</h2>
<p>Multiple data sets with complete data are generated from the original
data set with missing values using multiple imputation. There are
several packages in <code>R</code> such as <code>Amelia</code>,
<code>mice</code>, and <code>norm2</code> that can be used to generate
completed data sets. In the example below, we use the <code>mice</code>
package to generate <code>m = 100</code> completed data sets using the
joint specification approach by specifying <code>method = "norm"</code>.
The data sets are saved in the list <code>mi</code> of length
<code>m</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/amices/mice" class="external-link">mice</a></span><span class="op">)</span></span>
<span><span class="va">mi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html" class="external-link">complete</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://amices.org/mice/reference/mice.html" class="external-link">mice</a></span><span class="op">(</span></span>
<span>    <span class="va">data_missing</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"norm"</span>,</span>
<span>    m <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    print <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span></span>
<span>  <span class="op">)</span>,</span>
<span>  action <span class="op">=</span> <span class="st">"all"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-fitting">Model Fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h2>
<p>We fit the model to each of the <code>m = 100</code> data sets using
<code>lavaan</code>. The output is saved in the list
<code>fit</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lavaan.ugent.be" class="external-link">lavaan</a></span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">  y ~ x + b * m</span></span>
<span><span class="st">  m ~ a * x</span></span>
<span><span class="st">"</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">mi</span>,</span>
<span>  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>,</span>
<span>                 <span class="va">model</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/sem.html" class="external-link">sem</a></span><span class="op">(</span></span>
<span>      model <span class="op">=</span> <span class="va">model</span>,</span>
<span>      data <span class="op">=</span> <span class="va">data</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  model <span class="op">=</span> <span class="va">model</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pooling-estimates">Pooling Estimates<a class="anchor" aria-label="anchor" href="#pooling-estimates"></a>
</h2>
<p>We pool the estimates to generate the estimated parameter vector
(<code>param_vec</code>) and the sampling variance-covariance matrix
(<code>var_mat</code>).</p>
<p>We use the <code>lavaan::coef()</code> function to extract the
parameter estimates for each of the <code>m = 100</code> fitted models
and save the results in a list <code>param_vec</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">param_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">fit</span>,</span>
<span>  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We use the <code>lavaan::vcov()</code> function to extract the
sampling variance-covariance matrix for each of the <code>m = 100</code>
fitted models and save the results in a list <code>var_mat</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">fit</span>,</span>
<span>  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The estimates are combined using the
<code><a href="../reference/MICombine.html">manMCMedMiss::MICombine()</a></code> function. The
<code><a href="../reference/MICombine.html">manMCMedMiss::MICombine()</a></code> function uses a multivariate
approach to combining the entire sampling variance-covariance matrix and
not just the diagonal elements.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MICombine.html">MICombine</a></span><span class="op">(</span></span>
<span>  param_vec <span class="op">=</span> <span class="va">param_vec</span>,</span>
<span>  var_mat <span class="op">=</span> <span class="va">var_mat</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>A distribution of parameter estimates are generated from the
multivariate normal distribution using the pooled parameter estimates
vector and the total sampling variance-covariance matrix.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fl">20000</span></span>
<span><span class="va">mc</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="va">R</span>,</span>
<span>  mu <span class="op">=</span> <span class="va">mi</span><span class="op">$</span><span class="va">estimates</span>,</span>
<span>  Sigma <span class="op">=</span> <span class="va">mi</span><span class="op">$</span><span class="va">total</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The corresponding quantiles for the 95% confidence intervals, namely
2.5% and 97.5%, are the lower and upper limits of the Monte Carlo
confidence intervals.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span></span>
<span>  <span class="va">mc</span><span class="op">[</span>, <span class="st">"a"</span><span class="op">]</span> <span class="op">*</span> <span class="va">mc</span><span class="op">[</span>, <span class="st">"b"</span><span class="op">]</span>,</span>
<span>  probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;        2.5%       97.5% </span></span>
<span><span class="co">#&gt; 0.009149208 0.122679519</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Ivan Jacob Agaloos Pesigan.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
